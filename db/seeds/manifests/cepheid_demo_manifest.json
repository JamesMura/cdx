{
  "metadata": {
    "version": "1.0.94",
    "api_version": "1.1.0",
    "device_models": [
      "GX Model I"
    ],
    "conditions": [
      "MTB"
    ],
    "source": {
      "type": "json"
    }
  },
  "field_mapping": {
    "patient": [
      {
        "target_field": "age",
        "source": {
          "lookup": "event.age"
        },
        "type": "integer",
        "core": true,
        "indexed": true,
        "valid_values": {
          "range": {
            "min": 0,
            "max": 125
          }
        }
      },
      {
        "target_field": "gender",
        "source": { "map" : [
          { "lookup": "event.gender" },
          [
            { "match" : "M", "output" : "male"},
            { "match" : "F", "output" : "female"},
            { "match" : "*", "output" : "unknown"}
          ]
        ]},
        "type": "enum",
        "core": true,
        "indexed": true,
        "options": [
          "male",
          "female",
          "unknown"
        ]
      },
      {
        "target_field": "ethnicity",
        "source": { "map" : [
          { "lookup": "event.ethnicity" },
          [
            { "match" : "hispanic", "output" : "hispanic"},
            { "match" : "not_hispanic", "output" : "not_hispanic"},
            { "match" : "*", "output" : "unknown"}
          ]
        ]},
        "type": "enum",
        "core": true,
        "indexed": true,
        "options" : [
          "hispanic",
          "not_hispanic",
          "unknown"
        ]
      },
      {
        "target_field": "race",
        "source": { "map" : [
          {"lookup": "event.race"},
          [
            { "match" : "2054-5", "output" : "black_or_african_american"},
            { "match" : "1002-5", "output" : "american_indian_or_alaska_native"},
            { "match" : "2028-9", "output" : "asian"},
            { "match" : "2076-8", "output" : "native_hawaiian_or_other_pacific_islander"},
            { "match" : "2106-3", "output" : "white"},
            { "match" : "2131-1", "output" : "other"},
            { "match" : "*", "output" : "unknown"}
          ]
        ]},
        "type": "enum",
        "core": true,
        "indexed": true,
        "options" : [
          "black_or_african_american",
          "american_indian_or_alaska_native",
          "asian",
          "native_hawaiian_or_other_pacific_islander",
          "white",
          "other",
          "unknown"
        ]
      },
      {
        "target_field": "race_ethnicity",
        "source": { "map" : [
          {"lookup": "event.race_ethnicity"},
          [
            { "match" : "2135-2", "output" : "hispanic"},
            { "match" : "2054-5", "output" : "black_or_african_american"},
            { "match" : "1002-5", "output" : "american_indian_or_alaska_native"},
            { "match" : "2028-9", "output" : "asian"},
            { "match" : "2076-8", "output" : "native_hawaiian_or_other_pacific_islander"},
            { "match" : "2106-3", "output" : "white"},
            { "match" : "2131-1", "output" : "other"},
            { "match" : "*", "output" : "unknown"}
          ]
        ]},
        "type": "enum",
        "core": true,
        "indexed": true,
        "options" : [
          "hispanic",
          "black_or_african_american",
          "american_indian_or_alaska_native",
          "asian",
          "native_hawaiian_or_other_pacific_islander",
          "white",
          "other",
          "unknown"
        ]
      }
    ],
    "sample": [
      {
        "target_field": "sample_uid",
        "source": {
          "lookup": "event.sample_ID"
        },
        "type": "string",
        "core": true,
        "pii": true
      },
      {
        "target_field": "sample_id",
        "source": {
          "lookup": "event.sample_ID"
        },
        "type": "string",
        "core": true,
        "indexed": true
      }
    ],
    "test": [
      {
        "target_field": "start_time",
        "source": {
          "lookup": "event.start_time"
        },
        "type": "date",
        "core": true,
        "indexed": true
      },
      {
        "target_field": "end_time",
        "source": {
          "lookup": "event.end_time"
        },
        "type": "date"
      },
      {
        "target_field": "test_id",
        "source": {
          "lookup": "event.event_id"
        },
        "type": "string",
        "core": true,
        "indexed": true
      },
      {
        "target_field": "system_user",
        "source": {
          "lookup": "event.system_user"
        },
        "type": "string",
        "core": true,
        "indexed": true
      },
      {
        "target_field": "device_serial_number",
        "source": {
          "lookup": "event.device_serial_number"
        },
        "type": "string",
        "core": true,
        "indexed": true
      },
      {
        "target_field": "error_code",
        "source": {
          "lookup": "event.error_code"
        },
        "type": "integer",
        "core": true,
        "indexed": true
      },
      {
        "target_field": "error_description",
        "source": {
          "lookup": "event.error_description"
        },
        "type": "string",
        "core": true,
        "indexed": true
      },
      {
        "target_field": "assay_name",
        "source": {
          "lookup": "event.assay_name"
        },
        "type": "string",
        "core": true,
        "indexed": true,
        "options": [
          "MTB Assay",
          "Xpert SA Nasal Complete G3",
          "MTB-RIF Assay G4_noQC1_2"
        ]
      },
      {
        "target_field": "status",
        "source": { "map" : [
          { "lookup": "event.result" },
          [{"match" : "INVALID", "output" : "invalid" },
            {"match" : "ERROR", "output" : "error" },
            {"match" : "NO RESULT", "output" : "no_result" },
            {"match" : "MTB NOT DETECTED", "output" : "negative" },
            {"match" : "Rif Resistance DETECTED", "output" : "success" },
            {"match" : "Rif Resistance INDETERMINATE", "output" : "success" },
            {"match" : "MTB DETECTED", "output" : "success" },
            {"match" : "*", "output" : "error"}
          ]
        ]},
        "type": "enum",
        "core": true,
        "indexed": true,
        "options": [
          "invalid",
          "error",
          "no_result",
          "success",
          "negative"
        ]
      },
      {
        "target_field": "results[*].result",
        "source": { "map" : [
          { "lookup": "event.result" },
          [ {"match" : "INVALID", "output" : "unknown" },
            {"match" : "ERROR", "output" : "unknown" },
            {"match" : "NO RESULT", "output" : "unknown" },
            {"match" : "MTB NOT DETECTED", "output" : "negative" },
            {"match" : "Rif Resistance DETECTED", "output" : "positive_with_rif" },
            {"match" : "Rif Resistance INDETERMINATE", "output" : "positive_with_rif_inconclusive" },
            {"match" : "MTB DETECTED", "output" : "positive" },
            {"match" : "*", "output" : "unknown"}
          ]
        ]},
        "type": "enum",
        "core": true,
        "indexed": true,
        "options": [
          "unknown",
          "positive",
          "negative",
          "positive_with_rif",
          "positive_with_rif_inconclusive"
        ]
      },
      {
        "target_field": "results[*].condition",
        "source": { "map" : [
          { "lookup" : "event.assay_name"},
          [ {"match" : "Xpert MTB-RIF", "output" : "mtb"},
            {"match" : "Xpert MTB-RIF G3", "output" : "mtb"},
            {"match" : "MTB-RIF Assay G4", "output" : "mtb"},
            {"match" : "Xpert MTB-RIF Assay G4", "output" : "mtb"},
            {"match" : "MTB Beta", "output" : "mtb"},
            {"match" : "*", "output" : "mtb"}
          ]
        ]},
        "type": "enum",
        "core": true,
        "indexed": true,
        "options": [
          "mtb"
        ]
      },
      {
        "target_field": "test_type",
        "source": { "map" : [
          { "lookup": "event.test_type" },
          [
            { "match" : "0", "output" : "specimen"},
            { "match" : "*", "output" : "qc"}
          ]
        ]},
        "type": "enum",
        "core": true,
        "indexed": true,
        "options": [
          "specimen",
          "qc"
        ]
      }
    ]
  }
}
