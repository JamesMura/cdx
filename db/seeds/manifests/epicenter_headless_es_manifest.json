// sample_id
// test_id
// antibiotic_id
// patient_name
// patient_id
// hospital_name
// sample_type
// assay_name
// sequence_number (tube_id)
// test_status/result
// instrument_number (epicenter_device_id)
// test_type
// fecha de retirado del tubo
// start_date_time
// antibiotic_name
// sensibility result (S, R)
// concentration
// sample_end_time
// gender (1 - unknown, 2 - male, 3 - female)
// birth_date
// hiv (SINE - unknown, N - negative, P - positive)

{
  "metadata": {
    "version": "0.0.4",
    "api_version": "1.2.0",
    "signature": "",
    "device_models": [
      "epicenter_headless_es"
    ],
    "source": {
      "type": "headless_csv",
      "separator": ","
    }
  },
  "field_mapping": {
    "patient.id": { "lookup": "4" },
    "patient.name": { "lookup": "3" },
    "sample.id": { "lookup": "0" },
    "sample.uid": {
      "concat" : [
          {"lookup" : "4"},
          "-",
          {"lookup" : "0"}
      ]
    },
    "test.patient_age": {
      "if" : [
        {"equals" : [{"lookup" : "19"}, null]},
        "",
        {
          "years_between" : [
            {"parse_date" : [
              {"lookup" : "19"},
              "%Y-%m-%d %H:%M:%S.%L"
            ]},
            {"parse_date" : [
              {"lookup" : "13"},
              "%Y-%m-%d %H:%M:%S.%L"
            ]}
          ]
        }
      ]
    },
    "test.id": {
      "concat" : [
          {"lookup" : "0"},
          "-",
          {"lookup" : "9"},
          "-",
          {"lookup" : "1"},
          "-",
          {"lookup" : "2"}
      ]
    },
    "test.start_time": {
      "parse_date": [
        {
          "lookup": "13"
        },
        "%Y-%m-%d %H:%M:%S.%L"
      ]
    },
    "test.end_time": {
      "parse_date": [
        {
          "lookup": "12"
        },
        "%Y-%m-%d %H:%M:%S.%L"
      ]
    },
    "test.name": { "lookup": "7" },
    "test.assays[*].name": {
      "if" : [
        {"equals" : [{"lookup" : "11"}, "AST - MGIT"]},
        {
          "map": [
          {"lookup" : "14"},
          [
            {"match": "Estreptomicina", "output" : "streptomycin"},
            {"match": "Etambutol", "output" : "ethambutol"},
            {"match": "Rifampicina", "output" : "rifampicin"},
            {"match": "Pirazinamida", "output" : "pyrazinamide"},
            {"match": "Isoniazid", "output" : "isoniazid"},
            {"match": "*cido p-Aminosalic*lico", "output" : "p_aminosalicyclic_acid"},
            {"match": "Hidrazida del *cido tiofenocarbox*lico", "output" : "thiophenecarboxylic_acid_hydrazide"},
            {"match": "Levofloxacino", "output" : "levofloxacin"},
            {"match": "Tiosemicarbazona", "output" : "thiosemicarbazone"},
            {"match": "*", "output" : "mtb"}
          ]
        ]},
        "mtb"
      ]
    },
    "test.assays[*].qualitative_result": {
      "if" : [
        {"equals" : [{"lookup" : "11"}, "AST - MGIT"]},
        {
          "map": [
          {"lookup" : "15"},
          [
            {"match": "R", "output" : "positive"},
            {"match": "S", "output" : "negative"},
            {"match": "*", "output" : "n/a"}
          ]
        ]},
        {
          "map" : [
            {"lookup" : "9"},
            [
              {"match": "Positivo", "output" : "positive"},
              {"match": "Negativo", "output" : "negative"},
              {"match": "*", "output" : "n/a"}
            ]
          ]
        }
      ]
    },
    "test.status": {
      "if" : [
        {"equals" : [{"lookup" : "11"}, "AST - MGIT"]},
        {
          "map": [
          {"lookup" : "15"},
          [
            {"match": "S", "output" : "success"},
            {"match": "R", "output" : "success"},
            {"match": "*", "output" : "invalid"}
          ]
        ]},
        {
          "map" : [
            { "lookup": "9" },
            [
              {"match" : "Positivo", "output" : "success" },
              {"match" : "Completo retirado", "output" : "success" },
              {"match" : "Negativo", "output" : "negative" },
              {"match" : "No v√°lido", "output" : "invalid" },
              {"match" : "En curso retirado", "output" : "error" },
              {"match" : "Umbral positivo", "output" : "no_result" },
              {"match" : "*", "output" : "unknown"}
            ]
          ]
        }
      ]
    },
    "test.type": "specimen"
  }
}
