{
  "metadata": {
    "version": "0.0.10",
    "api_version": "1.1.0",
    "device_models": [
      "esequant_lr3"
    ],
    "source": {
      "type": "json"
    }
  },
  "field_mapping": {
    "patient" : [
      {
        "target_field": "patient_id",
        "source": {
          "lookup": "SampleId"
        },
        "type": "string",
        "core": true,
        "pii": true
      }
    ],
    "sample" : [
      {
        "target_field": "sample_uid",
        "source": {
            "lookup": "SampleId"
          },
        "type": "string",
        "core": true,
        "pii": true
      },
      {
        "target_field": "sample_id",
        "source": {
            "lookup": "SampleId"
          },
        "type": "string",
        "core": true,
        "indexed": true
      }
    ],
    "test" : [
      {
        "target_field": "start_time",
        "source": {
          "parse_date": [
            {
              "lookup": "MeasurementDateTime"
            },
            "%Y-%m-%d %H:%M:%S"
          ]
        },
        "type": "date",
        "core": true,
        "indexed": true
      },
      {
        "target_field": "test_id",
        "source": {
          "lookup": "RunNumber"
        },
        "type": "string",
        "core": true,
        "indexed": true
      },
      {
        "target_field": "system_user",
        "source": {
          "lookup": "User"
        },
        "type": "string",
        "core": true,
        "indexed": true
      },
      {
        "target_field": "device_serial_number",
        "source": {
          "concat": [
            {
              "lookup": "DeviceType"
            },
            "_",
            {
              "lookup": "SerialNumber"
            }
          ]
        },
        "type": "string",
        "core": true,
        "indexed": true
      },
      {
        "target_field": "error_code",
        "source": {
          "lookup": "error_code"
        },
        "type": "integer",
        "core": true,
        "indexed": true
      },
      {
        "target_field": "assay_name",
        "source": {
          "lookup": "ProductId"
        },
        "type": "enum",
        "core": true,
        "indexed": true,
        "options": [
          "MTBDRplus",
          "SD TB Ag MPT64",
          "Smear",
          "Solid Culture"
        ]
      },
      {
        "target_field": "results[*].result",
        "source" : {
          "map" : [
            {"lookup": "results[*].result"},
            [
              {"match": "positive_with_rmp_and_inh", "output" : "positive_with_rmp_and_inh"},
              {"match": "positive_with_rmp", "output" : "positive_with_rmp"},
              {"match": "positive_with_inh", "output" : "positive_with_inh"},
              {"match": "Positive", "output" : "positive"},
              {"match": "positive", "output" : "positive"},
              {"match": "valid", "output" : "valid"},
              {"match": "INVALID", "output" : "invalid"},
              {"match": "invalid", "output" : "invalid"},
              {"match": "negative", "output" : "negative"}
            ]
          ]
        },
        "type": "enum",
        "core": true,
        "indexed": true,
        "options": [
          "invalid",
          "valid",
          "positive",
          "negative",
          "positive_with_rmp_and_inh",
          "positive_with_rmp",
          "positive_with_inh"
        ]
      },
      {
        "target_field": "results[*].condition",
        "source": {
          "lookup": "results[*].condition"
        },
        "type": "enum",
        "core": true,
        "indexed": true,
        "options": [
          "mtb"
        ]
      },
      {
        "target_field": "test_type",
        "source": {
          "lookup": "SampleName"
        },
        "type": "enum",
        "core": true,
        "indexed": true,
        "options": [
          "specimen",
          "qc"
        ]
      }
    ]
  }
}
