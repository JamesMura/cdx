{
  "metadata" : {
    "version" : "0.0.2",
    "api_version" : "1.1.0",
    "signature" : "",
    "device_models" : ["epicenter_es"],
    "source": { "type" : "csv", "separator" : "," }
  },
  "field_mapping" : {
    "patient" : [
      {
        "target_field": "patient_id",
        "source" : {"lookup" : "ID del paciente"},
        "core" : true,
        "pii" : true,
        "type" : "string"
      },
      {
        "target_field": "patient_name",
        "source" : {"lookup" : "Nombre del paciente"},
        "core" : true,
        "pii" : true,
        "type" : "string"
      },
      {
        "target_field": "age",
        "source" : {"lookup" : "Edad del paciente"},
        "core" : true,
        "indexed" : true,
        "type" : "integer"
      },
      {
        "target_field": "gender",
        "source" : {
          "map" : [
            {"lookup" : "Sexo del paciente"},
            [
              {"match": "*Masculino*", "output" : "male"},
              {"match": "*Femenino*", "output" : "female"},
              {"match": "*", "output" : "unknown"}
            ]
          ]
        },
        "core" : true,
        "indexed" : true,
        "type" : "enum",
        "options" : ["male", "female", "unknown"]
      },
      {
        "target_field": "hiv",
        "source" : {
          "map" : [
            {"lookup" : "HIV"},
            [
              {"match": "*NEGATIVO*", "output" : "negative"},
              {"match": "*POSITIVO*", "output" : "positive"}
            ]
          ]
        },
        "core" : true,
        "indexed" : true,
        "type" : "enum",
        "options" : ["positive", "negative"]
      },
      {
        "target_field": "ethnicity",
        "source" : {"lookup" : "Ethnicity"},
        "core" : true,
        "indexed" : true,
        "type" : "enum",
        "options" : ["hispanic", "not_hispanic", "unknown"]
      },
      {
        "target_field": "race",
        "source" : {"lookup" : "Race"},
        "core" : true,
        "indexed" : true,
        "type" : "enum",
        "options" : ["black_or_african_american", "american_indian_or_alaska_native", "asian_native_hawaiian_or_other_pacific_islander", "white", "other", "unknown"]
      },
      {
        "target_field": "race_ethnicity",
        "source" : { "if" : [
          {"equals" : [{"lookup" : "Ethnicity"}, "hispanic"]},
          "hispanic",
          {"lookup" : "Race"}
        ]},
        "core" : true,
        "indexed" : true,
        "type" : "enum",
        "options" : ["hispanic", "black_or_african_american", "american_indian_or_alaska_native", "asian_native_hawaiian_or_other_pacific_islander", "white", "other", "unknown"]
      }
    ],
    "sample" : [
      {
        "target_field": "sample_id",
        "source" : {"lookup" : "N de Acceso"},
        "core" : true,
        "pii" : true,
        "type" : "string"
      },
      {
        "target_field": "sample_uid",
        "source" : {"concat" : [
          {"lookup" : "ID del paciente"},
          {"lookup" : "N de Acceso"}
        ]},
        "core" : true,
        "pii" : true,
        "type" : "string"
      },
      {
        "target_field": "sample_type",
        "source" : {
          "map" : [
            {"lookup" : "Tipo de muestra"},
            [
              {"match": "ES",  "output" : "sputum"},
              {"match": "LB",  "output" : "gastric_lavage"},
              {"match": "AB",  "output" : "bronchial_aspirate"},
              {"match": "AT",  "output" : "tracheal_aspirate"},
              {"match": "MB",  "output" : "mini_bal"},
              {"match": "BA",  "output" : "bal"},
              {"match": "APS", "output" : "psoas_abscess"},
              {"match": "APU", "output" : "lung_abscess"},
              {"match": "ACE", "output" : "cerebral_abscess"},
              {"match": "AOT", "output" : "other_abscess"},
              {"match": "BGA", "output" : "lymph_node_biopsy"},
              {"match": "BOS", "output" : "bone_biopsy"},
              {"match": "BPE", "output" : "peritoneal_biopsy"},
              {"match": "BPL", "output" : "pleural_biopsy"},
              {"match": "BCO", "output" : "colon_biopsy"},
              {"match": "BPI", "output" : "skin_biopsy"},
              {"match": "BOT", "output" : "other_biopsy"},
              {"match": "LAR", "output" : "synovial_fluid"},
              {"match": "LAS", "output" : "ascites_fluid"},
              {"match": "LPL", "output" : "pleural_fluid"},
              {"match": "LPE", "output" : "pericardial_fluid"},
              {"match": "LCR", "output" : "cerebrospinal_fluid"},
              {"match": "HC",  "output" : "blood_culture"},
              {"match": "MO",  "output" : "bone_marrow"},
              {"match": "MF",  "output" : "fecal_matter"},
              {"match": "OR",  "output" : "urine"},
              {"match": "PPP", "output" : "skin_and_soft_tissue_punctur"}
            ]
          ]
        },
        "indexed" : true,
        "type" : "enum",
        "options" : ["sputum", "gastric_lavage", "bronchial_aspirate", "tracheal_aspirate", "mini_bal", "bal", "psoas_abscess", "lung_abscess", "cerebral_abscess", "other_abscess", "lymph_node_biopsy", "bone_biopsy", "peritoneal_biopsy", "pleural_biopsy", "colon_biopsy", "skin_biopsy", "other_biopsy", "synovial_fluid", "ascites_fluid", "pleural_fluid", "pericardial_fluid", "cerebrospinal_fluid", "blood_culture", "bone_marrow", "fecal_matter", "urine", "skin_and_soft_tissue_puncture"]
      },
      {
        "target_field": "sample_type_group",
        "source" : {
          "map" : [
            {"lookup" : "Grupo de tipo de muestra"},
            [
              {"match": "GRPPUL", "output" : "extrapulmonary"},
              {"match": "GRPEXT", "output" : "intrapulmonary"}
            ]
          ]
        },
        "indexed" : true,
        "type" : "enum",
        "options" : ["extrapulmonary", "intrapulmonary"]
      }
    ],
    "test" : [
      {
        "target_field": "test_id",
        "source" : {
          "hash" : {
            "concat" : [
              {"lookup" : "ID del paciente"},
              {"lookup" : "N de Acceso"},
              {"lookup" : "Nombre del test"},
              {"lookup" : "Nombre del antibiotico del test"}
            ]
          }
        },
        "core" : true,
        "indexed" : true,
        "type" : "string"
      },
      {
        "target_field": "start_time",
        "source" : {
          "parse_date" : [
              {"lookup" : "Fecha y hora de recogida de la muesta"},
              "%d/%m/%Y %I:%M:%S %P"
            ]
        },
        "core" : true,
        "indexed" : true,
        "type" : "date"
      },
      // {
      //   "target_field": "system_user",
      //   "source" : {"lookup" : "WindowsUser"},
      //   "core" : true,
      //   "indexed" : true,
      //   "pii" : false,
      //   "type" : "string"
      // },
      {
        "target_field": "assay_name",
        "source" : {
          "concat" : [
            {"lookup" : "Nombre del test"},
            {"lookup" : "Nombre del antibiotico del test"}
          ]
        },
        "core" : true,
        "indexed" : true,
        "type" : "string"
      },
      {
        "target_field" : "results[*].condition",
        "source" : "mtb",
        "type" : "enum",
        "core" : true,
        "indexed" : true,
        "options" : ["mtb"]
      },
      {
        "target_field" : "results[*].result",
        "source" : {
          "if" : [
            {"equals" : [{"lookup" : "Estatus del test"}, "."]},
            {"concat" : [
              {
                "map": [
                {"lookup" : "Nombre del antibiotico del test"},
                [
                  {"match": "Estreptomicina", "output" : "streptomycin"},
                  {"match": "Etambutol", "output" : "ethambutol"},
                  {"match": "Rifampicina", "output" : "rifampicin"},
                  {"match": "Pirazinamida", "output" : "pyrazinamide"},
                  {"match": "Isoniacida", "output" : "isoniazid"},
                  {"match": "*cido p-Aminosalic*lico", "output" : "p_aminosalicyclic_acid"},
                  {"match": "Hidrazida del *cido tiofenocarbox*lico", "output" : "thiophenecarboxylic_acid_hydrazide"},
                  {"match": "Levofloxacino", "output" : "levofloxacin"},
                  {"match": "Tiosemicarbazona", "output" : "thiosemicarbazone"}
                ]
              ]},
              "_",
              {
                "map": [
                {"lookup" : "Resultado SIR del antibiotico del test"},
                [
                  {"match": "X", "output" : "invalid"},
                  {"match": "S", "output" : "sensitive"},
                  {"match": "R", "output" : "resistant"},
                  {"match": "*", "output" : "unknown"}
                ]
              ]}
            ]},
            {
              "map" : [
                {
                  "concat" : [
                    {"lookup" : "Estatus del test"}
                  ]
                },
                [
                  {"match": "*COMPLETA*", "output" : "positive"},
                  {"match": "*POSITIVO*", "output" : "positive"},
                  {"match": "*Positivo*", "output" : "positive"},
                  {"match": "*Completo*", "output" : "positive"},
                  {"match": "*Negativo*", "output" : "negative"},
                  {"match": "*NEGATIVO*", "output" : "negative"},
                  {"match": "*No v*lido*", "output" : "invalid"},
                  {"match": "*Contaminad*", "output" : "invalid"}
                ]
              ]
            }
          ]
        },
        "type" : "enum",
        "core" : true,
        "indexed" : true,
        "options" : [
          "streptomycin_unknown",
          "ethambutol_unknown",
          "rifampicin_unknown",
          "pyrazinamide_unknown",
          "isoniazid_unknown",
          "p_aminosalicyclic_acid_unknown",
          "thiophenecarboxylic_acid_hydrazide_unknown",
          "levofloxacin_unknown",
          "thiosemicarbazone_unknown",
          "streptomycin_sensitive",
          "ethambutol_sensitive",
          "rifampicin_sensitive",
          "pyrazinamide_sensitive",
          "isoniazid_sensitive",
          "p_aminosalicyclic_acid_sensitive",
          "thiophenecarboxylic_acid_hydrazide_sensitive",
          "levofloxacin_sensitive",
          "thiosemicarbazone_sensitive",
          "streptomycin_resistant",
          "ethambutol_resistant",
          "rifampicin_resistant",
          "pyrazinamide_resistant",
          "isoniazid_resistant",
          "p_aminosalicyclic_acid_resistant",
          "thiophenecarboxylic_acid_hydrazide_resistant",
          "levofloxacin_resistant",
          "thiosemicarbazone_resistant",
          "streptomycin_invalid",
          "ethambutol_invalid",
          "rifampicin_invalid",
          "pyrazinamide_invalid",
          "isoniazid_invalid",
          "p_aminosalicyclic_acid_invalid",
          "thiophenecarboxylic_acid_hydrazide_invalid",
          "levofloxacin_invalid",
          "thiosemicarbazone_invalid",
          "positive",
          "negative",
          "invalid"
        ]
      },
      {
        "target_field" : "status",
        "source" : {
          "map" : [
            {"lookup" : "Estatus del test"},
            [
              {"match": "No v*lido", "output" : "invalid"},
              {"match": "Negativo", "output" : "negative"},
              {"match": "*", "output" : "success"}
            ]
          ]
        },
        "type" : "enum",
        "core" : true,
        "indexed" : true,
        "options":["invalid","success","negative"]
      },
      {
        "target_field": "test_type",
        "source" : "specimen",
        "core" : true,
        "indexed" : true,
        "pii" : false,
        "type" : "enum",
        "options" : ["specimen"]
      }
    ]
  }
}
