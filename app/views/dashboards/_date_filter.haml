%section.row
  .small-12.columns
    .search
      %form#filters-form{ action: filter_action }
        .topdatefrom
          %label.block
            = I18n.t('dashboard.index.date_from')
          = date_field('range','start_time[gte]', value: (params['range'].nil? ? '' : params['range']['start_time']['gte']), max: Date.today)

        .topdateto
          %label.block
            = I18n.t('dashboard.index.date_to')
          = date_field('range','start_time[lte]', value: (params['range'].nil? ? '' : params['range']['start_time']['lte']) )

        .topdateperiod
          .filter
            %label.block
              = I18n.t('dashboard.index.date_period')
            = cdx_select name: 'since', value: params['since'] do |select|
              - select.items Extras::Dates::Filters.date_options_for_filter, :value, :label

          .topbutton
            %input#clear_button.btn-primary(type='clear' value="#{I18n.t('dashboard.index.filter_button')}")

:javascript
  $(document).ready( function()
  {
    $('#clear_button').on('click', function()
    {
      $('input#range_start_time\\[gte\\]').val( '0000-00-00' );
      $('input#range_start_time\\[lte\\]').val( '0000-00-00' );
      $(this).hide();
    });

    $('input#range_start_time\\[gte\\]').on('change', function()
    {
      var other = $('input#range_start_time\\[lte\\]').val();
      if(other)
        $('#filters-form').submit();
    });

    $('input#range_start_time\\[lte\\]').on('change', function()
    {
      var other = $('input#range_start_time\\[gte\\]').val();
      if(other)
        $('#filters-form').submit();
    });

    $('input[name=since]').on('change', function()
    {
      $('input#range_start_time\\[gte\\]').val( $(this).val() );
      $('input#range_start_time\\[lte\\]').val( new Date().toJSON().slice(0,10) );
      $('#filters-form').submit();
    });

    if( $('input#range_start_time\\[lte\\]').val() || $('input#range_start_time\\[gte\\]').val() )
      $('#clear_button').show();
    else
      $('#clear_button').hide();

  })
