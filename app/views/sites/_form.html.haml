= form_for(@site) do |f|
  - if @site.errors.present?
    .alert-container
      .alert.alert-error
        %ul
          - @site.errors.full_messages.each do |msg|
            %li= msg

  = render 'shared/select_institution_or_hidden', f: f

  .row
    .col.pe-2
      = f.label :name
    .col
      = f.text_field :name, :class => 'input-large'
  .row
    .col.pe-2
      = f.label :location_geoid, "Location"
    .col
      = f.hidden_field :location_geoid, class: 'input-large'
  - if @site.new_record?
    .row
      .col.pe-2
        = f.label :parent
      .col
        = cdx_select form: f, name: :parent_id, class: 'input-x-large' do |select|
          - select.item "", "Choose one"
          - select.items @sites, :id, :name
  - elsif @site.parent
    .row
      .col.pe-2
        = f.label :parent
      .col
        = @site.parent.name
  .row
    .col.pe-2
      = f.label :sample_id_reset_policy, "Sample ID reset policy"
    .col
      = cdx_select form: f, name: :sample_id_reset_policy, class: 'input-xx-large' do |select|
        - select.item "yearly", "Yearly"
        - select.item "monthly", "Monthly"
        - select.item "weekly", "Weekly"

  .row.button-actions
    .col
      = f.submit 'Save', class: 'btn-primary'
      = link_to 'Cancel', sites_path, class: 'btn-link'
      - if @can_delete
        - if @can_be_deleted
          = link_to "Delete", @site, method: :delete, data: { confirm: "You're about to permanently delete this site. This action CANNOT be undone. Are you sure you want to proceed?" }, class: 'btn-secondary pull-right', title: 'Delete Site'
        - else
          - # TODO: link to page with Devices tab always active - it's the current default, but may change
          = content_tag 'a', "Delete", data: { confirm: "In order to delete this site you must first reassign the <a href=\"#{site_path(@site)}\">#{@site.devices.count} #{"device".pluralize(@site.devices.count)}</a> assigned to it.", confirm_title: 'Action required', confirm_hide_cancel: 'true', confirm_button_message: 'Understood' }, class: 'btn-secondary pull-right', title: 'Delete Site'
