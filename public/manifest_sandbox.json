{
  "metadata" : {
    "version" : "1.0.1",
    "api_version" : "1.0.0",
    "signature" : "12345",
    "device_models" : ["default"],
    "source_data_type": "json", // CSV source must have flat lookups
  },
  "field_mapping" : {
    "sample" : [
      {
        "target_field": "id",
        "source" : {"lookup" : "sample.id"},
        "core" : true,
        "indexed" : true,
        "type" : "integer"
      },
      {
        "target_field": "type",
        "source" : {"lookup" : "sample.type"},
        "core" : true,
        "indexed" : true,
        "type" : "enum",
        "options" : [
          "blood",
          "urine",
          "sputum",
          "stool",
          "biopsy"
        ]
      }
    ],
    "patient" : [
      {
        "target_field" : "id",
        "source" : {"lookup" : "patient.id"},
        "type" : "string",
        "core" : true,
        "pii" : true,
        "indexed" : false
      },
      {
        "target_field" : "name",
        "source" : {"lookup" : "patient.name"},
        "type" : "string",
        "core" : true,
        "pii" : true,
        "indexed" : false
      },
      {
        "target_field" : "telephone_number",
        "source" : {"lookup" : "patient.telephone_number"},
        "type" : "string",
        "core" : true,
        "pii" : true,
        "indexed" : false
      },
      {
        "target_field" : "zip_code",
        "source" : {"lookup" : "patient.zip_code"},
        "type" : "string",
        "core" : true,
        "pii" : true,
        "indexed" : false
      }
    ],
  "event" : {
    "root_path" : "tests", // only if multiple
    "fields": [ // if not multiple, event will be the fields array directly
      {
        "target_field": "start_time",
        "source" : {"lookup" : "start_time"},
        "core" : true,
        "indexed" : true,
        "type" : "date"
      },
      {
        "target_field": "event_id",
        "source" : {"lookup" : "event_id"},
        "type": "integer",
        "core" : true,
        "indexed" : true
      },
      {
        "target_field" : "location",
        "source" : {"lookup" : "location"},
        "type" : "location",
        "core" : true,
        "indexed" : true
      },
      {
        "target_field": "age",
        "source" : {"lookup" : "age"},
        "type": "integer",
        "indexed" : "true",
        "core" : true,
        "valid_values" : {
          "range" : {
            "min" : 0,
            "max" : 125
          }
        }
      },
      {
        "target_field": "events[*].results[*].result",
        "source" : [
            [{"lookup" : "MGIT"}],
            [{"lookup" : "LG"}]
        ],
        "core" : true,
        "indexed" : false,
        "pii" : true,
        "type" : "string"
      },
      {
        "target_field": "events[*].results[*].condition",
        "source" : [ "mtb", "mtb" ],
        "core" : true,
        "indexed" : false,
        "pii" : true,
        "type" : "string"
      },
      {
        "target_field": "events[*].test_type",
        "source" : [ "MGIT", "LG" ],
        "core" : true,
        "indexed" : false,
        "pii" : true,
        "type" : "string"
      },
      {
        "target_field": "assay_name",
        "source" : {"lookup" : "assay_name"},
        "type" : "enum",
        "core" : true,
        "options" : [
          "cartridge_1",
          "cartridge_2"
        ]
      },
      {
        "target_field" : "system_user",
        "source" : {"lookup" : "system_user"},
        "type": "string",
        "core" : true,
        "pii" : false,
        "indexed" : false
      },
      {
        "target_field" : "results[*].condition",
        "source" : {"lookup" : "results[*].condition"},
        "type" : "enum",
        "core" : true,
        "indexed" : true,
        "options" : [
          "flu_a",
          "flu_b",
          "h1n1",
          "mtb"
        ]
      },
      {
        "target_field" : "results[*].result",
        "source" : {"lookup" : "results[*].result"},
        "type" : "enum",
        "core" : true,
        "indexed" : true,
        "options" : {
          "when" : [
            {
              "property" : "condition",
              "value" : "mtb",
              "options" : [
                "positive",
                "positive_with_rif",
                "negative"
              ]
            },
          ],
          "else" : {
            "options" : [
              "positive",
              "negative"
            ]
          }
        }
      },
      {
        "target_field": "grade_of_resistance",
        "source" : {"lookup" : "resistance"},
        "core" : false,
        "type": "integer",
        "valid_values": {
          "range" : {
            "min" : 0,
            "max" : 100
          }
        }
      },
      {
        "target_field": "device_serial_number",
        "source" : {"lookup" : "device_serial_number"},
        "type" : "string",
        "core": true
      },
      {
        "target_field": "test_type",
        "source" : {"lookup" : "test_type"},
        "type" : "string",
        "core" : true
      },
      {
        "target_field": "temperature",
        "source" : {"lookup" : "temperature"},
        "core" : false,
        "type": "integer",
        "pii" : false,
        "valid_values": {
          "range" : {
            "min" : -20,
            "max" : 60
          }
        },
        "indexed" : true
      },
      {
        "target_field": "percentage_of_confidence",
        "core" : false,
        "type": "integer",
        "source" : {"lookup" : "percentage"},
        "pii" : false,
        "valid_values": {
          "range" : {
            "min" : 0.001,
            "max" : 999.999
          }
        },
        "indexed" : true
      },
      {
        "target_field": "end_time",
        "source" : {"lookup" : "end_time"},
        "type": "date",
        "core" : false,
        "pii" : "false",
        "valid_values": {
          "date" : "iso"
        },
        "indexed" : true
      }
    ]
  }
}
