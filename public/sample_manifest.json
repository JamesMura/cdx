{
  "metadata" : {
    "version" : "1.0.0",
    "signature" : "12345",
    "device_models" : ["GX4001", "GX4002"],
    "source_data_type": "json"
  },
  "field_mapping" : [
    {
    	"target_field": "patient_name",
      "selector" : "patient_information.name",
      "type" : "core"
    },
    {
      "target_field": "age",
      "type": "core",
      "source" : { //age="24mo"
        "days_in" : ["month", {"slice": {"path" : "patient_information.age"}}]
      },
      "valid_values": {
        "range" : {
          "min" : 0,
          "max" : 100
        }
      }
    },
    {
    	"target_field": "assay_name",
      "selector" : "Test.assay_name",
      "type" : "core"
    },
    { // this field is clearly not pii, but the catch is how to restrict it to the system user and not the patient name, the length could be a possibility
    	"target_field": "system_user",
      "selector" : "doctor_name",
      "type": "custom",
      "pii" : false,
      "indexed" : false,
      "valid_values": {
        "length" : 6
      }
    },
    {
    	"target_field": "results[*].condition",
    	"type": "core",
      "multiple" : true,
      "source" : {
        "mapping": [
          {"path" : "conditions[*].condition"},
          [
            {"match": "*MTB*", "output" : "MTB"},
            {"match": "*FLU*", "output" : "H1N1"},
            {"match": "*FLUA*", "output" : "A1N1"}
          ]
        ]
      }
    },
    {
    	"target_field": "results[*].result",
    	"type": "core",
      "selector" : "conditions[*].condition",
      "value_mappings" : {
        "*NOT DETECTED*" : "negative",
        "*POSITIVE*" : "positive",
        "*POSITIVE WITH RIF*" : "positive with rif"
      }
    },
    {
     	"target_field": "grade_of_resistance",
     	"type": "custom",
      "selector" : "resistance",
      "valid_values": {
        "range" : {
          "min" : 0,
          "max" : 100
        }
      }
    },
    {
    	"target_field": "device_serial_number",
    	"type": "core",
      "selector" : "patient_information.name"
    },
    {
    	"target_field": "test_type",
      "selector" : "Test.test_type",
      "type": "custom",
      "pii" : false,
      "valid_values" : {
        "options" : [0, 1]
      }
    },
    {
    	"target_field": "temperature",
    	"type": "custom",
      "selector" : "Test.temp",
      "pii" : false,
      "valid_values": {
        "range" : {
          "min" : -20,
          "max" : 60
        }
      },
      "indexed" : true
    },
    {
    	"target_field": "percentage_of_confidence",
    	"type": "custom",
      "selector" : "Test.percent",
      "pii" : false,
      "valid_values": {
        "range" : {
          "min" : 0.001,
          "max" : 999.999
        }
      },
      "indexed" : true
    },
    {
    	"target_field": "end_time",
    	"type": "custom",
      "selector" : "Test.end_time",
      "pii" : "false",
      "valid_values": {
        "date" : "iso"
      },
      "indexed" : true
    }
  ]
}
